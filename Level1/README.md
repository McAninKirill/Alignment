# Level1
–í —ç—Ç–æ–º —É—Ä–æ–≤–Ω–µ –º–Ω–µ –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º REINFORCE –∏–∑ —Å—Ç–∞—Ç—å–∏ [Ahmadian et al, Back to Basics: Revisiting REINFORCE Style Optimization for Learning from Human Feedback in LLMs]. –î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–∞ sft –º–æ–¥–µ–ª—å –∏ reward –º–æ–¥–µ–ª—å. 
### SFT model 
–Ø –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª [HuggingFaceTB/SmolLM2-135M-Instruct](https://huggingface.co/HuggingFaceTB/SmolLM2-135M-Instruct), –∫–∞–∫ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤ –∑–∞–¥–∞–Ω–∏–∏.
### Reward model
–Ø –æ–±—É—á–∏–ª reward –º–æ–¥–µ–ª—å –ø–æ–≤–µ—Ä—Ö sft, –∏—Å–ø–æ–ª—å–∑—É—è –±–∏–±–ª–∏–æ—Ç–µ–∫—É [trl](https://github.com/huggingface/trl). –í tokenizer —è –æ–≥—Ä–∞–Ω–∏—á–∏–ª max_length –∑–Ω–∞—á–µ–Ω–∏–µ–º 512, –ø–æ—Ç–æ–º—É —á—Ç–æ —É –º–µ–Ω—è –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –º–æ—â–Ω–æ—Å—Ç–µ–π.
## REINFORCE
–ù–∞ –¥–∞–Ω–Ω–æ–º —ç—Ç–∞–ø–µ –Ω—É–∂–Ω–æ —è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª —Ñ–æ—Ä–º—É–ª—É –∏–∑ —Å—Ç–∞—Ç—å–∏, —á—Ç–æ–±—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å sft –º–æ–¥–µ–ª—å, –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é –ø—Ä–æ–º–ø—Ç–∞ –∏ –æ—Ç–≤–µ—Ç–∞:
```
ùîº‚Çì‚àºùíü, y‚àºœÄŒ∏(¬∑|x) [ (R(y, x) - b) ‚àáŒ∏ log œÄŒ∏(y|x) ]
```
(1)

### –ù–∞–≥—Ä–∞–¥–∞ –º–æ–¥–µ–ª–∏:
$R (x, y)$ - —ç—Ç–æ –Ω–∞–≥—Ä–∞–¥–∞ –º–æ–¥–µ–ª–∏, –∫–æ—Ç–æ—Ä–∞—è –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø–æ —Ñ–æ—Ä–º—É–ª–µ:

$R(x, y) = r_{\phi}(x, y) - \beta \log \left( \frac{\pi_{\theta}(y|x)}{\pi_{\mathrm{ref}}(y|x)} \right) (2)$

$r_{\phi}(x, y)$ - —ç—Ç–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ reward –º–æ–¥–µ–ª–µ, —á—Ç–æ–±—ã –æ–Ω–∞ –æ—Ü–µ–Ω–∏–ª–∞, –Ω–∞—Å–∫–æ–ª—å–∫–æ –≤—ã—Ö–æ–¥ –∏–∑ current policy —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∂–µ–ª–∞–Ω–∏—é –ø—Ä–æ–º–ø—Ç–∞.
$\log \left( \frac{\pi_{\theta}(y|x)}{\pi_{\mathrm{ref}}(y|x)} \right)$ - —ç—Ç–æ –Ω–∏—á—Ç–æ –∏–Ω–æ–µ, –∫–∞–∫ KL-–¥–∏–≤–µ—Ä–≥–µ–Ω—Ü–∏—è –º–µ–∂–¥—É current policy –∏ sft.
$\beta$ - –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏ –æ—Ç current policy
–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –Ω–∞–≥—Ä–∞–¥–∞ –¥–æ–ª–∂–Ω–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å –º–µ–∂–¥—É —Ç–µ–º, —á—Ç–æ–±—ã "—Ö–≤–∞–ª–∏—Ç—å" –º–æ–¥–µ–ª—å –∑–∞ —Ç–æ, —á—Ç–æ –æ–Ω–∞ –≤—ã–¥–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç, –æ–Ω "—Ä—É–≥–∞—Ç—å" –∑–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏.
### Baseline
b - —ç—Ç–æ baseline –≤ —Ñ–æ—Ä–º—É–ª–µ (1), –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–µ–Ω –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏–µ –¥–∏—Å–ø–µ—Ä—Å–∏–∏ –æ—Ü–µ–Ω–∫–∏, –ø–æ—ç—Ç–æ–º—É –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã baseline –∏–º–µ–ª –≤—ã—Å–æ–∫—É—é –∫–æ–≤–∞—Ä–∏–∞—Ü–∏—é —Å –æ—Ü–µ–Ω–∫–æ–π —Å—Ç–æ—Ö–∞—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞.
–°—Ç–∞—Ç—å—Å—è –ø—Ä–µ–¥–ª–æ–≥–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–≤–µ –æ–ø—Ü–∏—è –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –¥–∏—Å–ø–µ—Ä—Å–∏–∏ –æ—Ü–µ–Ω–∫–∏: Leave-One-Out –∏ moving average. 
Leave-One-Out –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ–±—ã –≤ —Ç–æ–º, —á—Ç–æ–±—ã –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤—ã–±–æ—Ä–æ–∫, –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞. –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –º–Ω–µ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç, —Ç–∞–∫ –∫–∞–∫ –∫–∞–¥–∂–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç–æ–∏—Ç –æ—á–µ–Ω—å –¥–æ—Ä–æ–≥–æ –ø–æ –≤—Ä–µ–º–µ–Ω–∏, –∞ –º–æ–∏ —Ä–µ—Å—É—Ä—Å—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã.
–ì–æ—Ä–∞–∑–¥–æ –ª—É—á—à–µ –≤—ã–≥–ª—è–¥–∏—Ç moving average, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è –Ω–∏—á–µ–º —è–Ω—ã–º —Å—Ä–µ–¥–Ω–∏–º –æ—Ç –≤—Å–µ—Ö –Ω–∞–≥—Ä–∞–¥ –º–æ–¥–µ–ª–∏.
```
b_MA = (1/S) ‚àë‚Çõ R(xÀ¢, yÀ¢)
```
## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
–Ø –æ–±—É—á–∞–ª —Ç–æ–ª—å–∫–æ –Ω–∞ 12 –∏—Ç–µ—Ä–∞—Ü–∏–∏, —Ç–∞–∫ –∫–∞–∫ –±–æ–ª—å—à–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–µ —Å–º–æ–≥. –¢–∞–∫ –∫–∞–∫ –∏—Ç–µ—Ä–∞—Ü–∏–π –±—ã–ª–æ –º–∞–ª–æ, –º–Ω–µ –ø—Ä–∏—à–ª–æ—Å—å —É–≤–µ–ª–∏—á–∏—Ç—å learning rate –¥–æ 1e-3, –≤ –∏–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö –º–æ–¥–µ–ª—å –æ–±—É—á–∞–ª–∞—Å—å, –Ω–æ –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ.
–ò —Ç–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –≤—ã–≥–ª—è–¥–∏—Ç –≤–æ—Ç —Ç–∞–∫:
```
Evaluating SFT model...
Reward statistics:
Min: 0.03
Max: 0.79
Mean: 0.33

Evaluating trained model...
Reward statistics:
Min: 0.19
Max: 0.72
Mean: 0.43
SFT Reward: 0.325
Trained Reward: 0.434
```
–ü—Ä–µ–∫—Ä–∞—Å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∏–ª—å–Ω–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç–≤–µ—Ç–æ–≤ –º–æ–¥–µ–ª–∏ –≤—Å–µ–≥–æ –Ω–∞ 12 –∏—Ç–µ—Ä–∞—Ü–∏–π. –°–∞–º–æ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ, —á—Ç–æ —Å—É–¥—è –ø–æ –æ—Ü–µ–Ω–∫–∞–º –º–æ–¥–µ–ª—å —Å—Ç–∞–ª–∞ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Ä–µ–∂–µ –≤—ã–¥–∞–≤–∞—Ç—å –æ—Ç–∫—Ä–æ–≤–µ–Ω–Ω–æ –ø–ª–æ—Ö–∏–µ –æ—Ç–≤–µ—Ç—ã.
